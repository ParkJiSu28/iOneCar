<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>i-One Car | 상세 견적</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" th:href="@{/css/compare.css}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
</head>
<body>
<div class="container">
    <div class="main-header">
        <span class="header-title">i-One Car ㅣ 견적 상세</span>
        <button class="close-btn">
            <img th:src="@{/css/images/X.png}" alt="닫기" class="close-icon" />
        </button>
    </div>
    <div class="detail-card">
        <!-- 차량정보/이미지 -->
        <div class="car-info-row">
            <div class="car-info-text">
                <div class="car-name" th:text="${carClass}"></div>
                <div class="car-desc">
                    <span th:text="${carSubClass}"></span><br/>
                    <span th:text="${purchaseMethod}"></span>
                    <span th:text="${purchasePeriod} + '개월'"></span>
                </div>
            </div>
            <div class="car-img-block">
                <img th:src="@{/css/images/a-class.png}" alt="차 이미지" class="car-img" />
            </div>
        </div>

        <!-- 가격정보: 하나의 회색 박스 -->
        <div class="price-area-box">
            <!-- 차량 기본가 -->
            <div class="price-detail">
                <span class="label">차량 기본가</span>
                <span class="value" th:text="${#numbers.formatInteger(carPrice, 0, 'COMMA')} + '원'"></span>
            </div>
            <!-- 추가 옵션가 -->
            <div class="price-detail">
                <span class="label">추가 옵션가</span>
                <span class="value" th:text="${#numbers.formatInteger(optPrice, 0, 'COMMA')} + '원'"></span>
            </div>
            <!-- 총 예상금액 -->
            <div class="price-detail total">
                <span class="label">총 예상금액</span>
                <span class="value" th:text="${#numbers.formatInteger(carPrice + optPrice, 0, 'COMMA')} + '원'"></span>
            </div>
        </div>

        <!-- 딜러 정보를 동적으로 표시 -->
        <div th:each="compare : ${compares}" class="dealer-label-with-card">
            <div class="dealer-label" 
                 th:text="${compare.progress == '1' ? '딜러와 상담요청 전입니다.' : (compare.progress == '2' ? '딜러와 상담이 진행중입니다.' : '딜러와 상담요청 전입니다.')}"
                 th:style="${compare.progress == '2' ? 'color: red;' : ''}"></div>
            <div class="dealer-card">
                <img th:src="@{/css/images/dealer1.png}" alt="딜러 프로필" class="dealer-photo" />
                <div class="dealer-profile-info">
                    <span class="dealer-name" th:onclick="'goToProfile(\'' + ${compare.dealerNo} + '\')'" style="cursor: pointer;" th:text="${compare.dealerName}">딜러명</span>
                    <span class="dealer-rating">
                        <img th:src="@{/css/images/star.png}" alt="별" class="star-icon" />
                        <span th:text="${compare.rating}">5.0</span>
                        <span class="review-count" th:text="'(' + ${compare.reviewCnt} + ')'"></span>
                    </span>
                    <span class="quotation-count" th:text="${compare.quotationCnt} + '건'"></span>
                </div>
                <div class="dealer-body">
                    <div class="info-col">
                        <span class="label">할인금액</span>
                        <span class="value" th:text="${#numbers.formatInteger(compare.discount, 0, 'COMMA')} + '원'"></span>
                    </div>
                    <!-- 구매방법에 따른 조건부 표시 -->
                    <div th:if="${purchase != null and purchase.purchaseMethod == 'C'}" class="info-col">
                        <span class="label">일시납</span>
                        <span class="value" th:text="${#numbers.formatInteger(compare.monthlyPayment, 0, 'COMMA')} + '원'"></span>
                    </div>
                    <div th:if="${purchase == null or purchase.purchaseMethod != 'C'}" class="info-col">
                        <span class="label">월납입료</span>
                        <span class="value" th:text="${#numbers.formatInteger(compare.monthlyPayment, 0, 'COMMA')} + '원'"></span>
                    </div>
                    <!-- 이용금리는 일시불('C')이 아닐 때만 표시 -->
                    <div th:if="${purchase == null or purchase.purchaseMethod != 'C'}" class="info-col">
                        <span class="label">이용금리</span>
                        <span class="value" th:text="${compare.rate} + '%'"></span>
                    </div>
                </div>
                <a th:href="@{/myquote/detail(carSrn=${carSrn}, dealerNo=${compare.dealerNo})}" class="dealer-detail-btn">상세견적</a>
            </div>
        </div>
    </div>
</div>

</body>
</html>
