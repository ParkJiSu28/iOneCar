<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>i-One Car | 결제하기</title>
    <link rel="stylesheet" th:href="@{/css/consent.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- 상단 헤더 -->
        <header class="main-header">
            <h1 class="header-title">i-One Car | 결제하기</h1>
            <button class="close-btn" onclick="history.back()">
                <img src="/css/images/X.png" alt="닫기" class="close-icon">
            </button>
        </header>

        <!-- 메인 컨텐츠 -->
        <main class="main-content">
            <!-- 동의서 섹션 -->
            <div class="consent-section">
                <h2 class="consent-title">약관 및 동의서</h2>
                
                <!-- 전체동의 -->
                <div class="consent-group main-consent">
                    <label class="consent-item">
                        <input type="checkbox" id="allConsent" name="allConsent">
                        <span class="checkmark"></span>
                        <span class="consent-text">전체동의</span>
                        <span class="arrow">></span>
                    </label>
                </div>

                <!-- 상세 동의 항목들 -->
                <div class="consent-details">
                    <!-- 개인신용정보 수집 이용 및 제공 관련 고객 권리 안내문 -->
                    <div class="consent-group">
                        <label class="consent-item">
                            <input type="checkbox" name="personalInfo" class="detail-consent">
                            <span class="checkmark"></span>
                            <span class="consent-text">개인(신용)정보 수집, 이용 및 제공 관련 고객 권리 안내문 (필수)</span>
                            <span class="arrow">></span>
                        </label>
                    </div>

                    <!-- 개인신용정보 조회 동의서 -->
                    <div class="consent-group">
                        <label class="consent-item">
                            <input type="checkbox" name="creditInquiry" class="detail-consent">
                            <span class="checkmark"></span>
                            <span class="consent-text">개인(신용)정보 조회 동의서 (필수)</span>
                            <span class="arrow">></span>
                        </label>
                    </div>

                    <!-- 개인정보 수집이용제공 동의서 -->
                    <div class="consent-group">
                        <label class="consent-item">
                            <input type="checkbox" name="personalDataUsage" class="detail-consent">
                            <span class="checkmark"></span>
                            <span class="consent-text">개인정보 수집·이용·제공 동의서(여신 금융거래) (필수)</span>
                            <span class="arrow">></span>
                        </label>
                    </div>

                    <!-- 건강보험공단 및 국민연금공단 조회제공 동의 -->
                    <div class="consent-group">
                        <label class="consent-item">
                            <input type="checkbox" name="healthInsurance" class="detail-consent">
                            <span class="checkmark"></span>
                            <span class="consent-text">건강보험공단 및 국민연금공단 조회제공 동의 (필수)</span>
                            <span class="arrow">></span>
                        </label>
                    </div>

                    <!-- 공공 마이데이터 관련 개인신용정보 조회 동의서 -->
                    <div class="consent-group">
                        <label class="consent-item">
                            <input type="checkbox" name="publicMyData" class="detail-consent">
                            <span class="checkmark"></span>
                            <span class="consent-text">공공 마이데이터 관련 개인(신용)정보 조회 동의서 (필수)</span>
                            <span class="arrow">></span>
                        </label>
                    </div>

                    <!-- 통신정보 수집이용 동의 -->
                    <div class="consent-group">
                        <label class="consent-item">
                            <input type="checkbox" name="communicationInfo" class="detail-consent">
                            <span class="checkmark"></span>
                            <span class="consent-text">통신정보 수집·이용 동의 (선택)</span>
                            <span class="arrow">></span>
                        </label>
                    </div>

                    <!-- 동의시 안내문 -->
                    <div class="consent-notice">
                        <p>이동의시 금리우대 및 한도우대 혜택이 있을 수 있습니다.</p>
                    </div>
                </div>

                <!-- 개인신용정보 수집이용 동의서 -->
                <div class="consent-group main-consent">
                    <label class="consent-item">
                        <input type="checkbox" id="personalCreditConsent" name="personalCreditConsent">
                        <span class="checkmark"></span>
                        <span class="consent-text">개인(신용)정보 수집·이용 동의서(상품서비스 안내) (선택)</span>
                        <span class="arrow">></span>
                    </label>
                </div>
            </div>
        </main>

        <!-- 하단 버튼 -->
        <div class="bottom-button">
            <button class="btn btn-secondary" onclick="goBack()">이전</button>
            <button class="btn btn-secondary" id="nextBtn" onclick="handleNext()">다음</button>
        </div>
    </div>

    <script>
        const allConsentCheckbox = document.getElementById('allConsent');
        const personalCreditConsentCheckbox = document.getElementById('personalCreditConsent');
        const detailConsentCheckboxes = document.querySelectorAll('.detail-consent');
        const nextBtn = document.getElementById('nextBtn');

        // 전체동의 체크박스 변경 감지
        allConsentCheckbox.addEventListener('change', function() {
            const isChecked = this.checked;
            
            // 상세 동의 항목들 모두 체크/해제
            detailConsentCheckboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
            });
            
            updateNextButton();
        });

        // 개별 상세 동의 체크박스 변경 감지
        detailConsentCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                // 모든 필수 항목이 체크되었는지 확인
                const requiredCheckboxes = Array.from(detailConsentCheckboxes).filter(cb => 
                    cb.name !== 'communicationInfo' // 선택 항목 제외
                );
                
                const allRequiredChecked = requiredCheckboxes.every(cb => cb.checked);
                
                // 전체동의 체크박스 상태 업데이트
                if (allRequiredChecked && Array.from(detailConsentCheckboxes).every(cb => cb.checked)) {
                    allConsentCheckbox.checked = true;
                } else {
                    allConsentCheckbox.checked = false;
                }
                
                updateNextButton();
            });
        });

        // 개인신용정보 수집이용 동의서 (선택) 체크박스 변경 감지
        personalCreditConsentCheckbox.addEventListener('change', function() {
            updateNextButton();
        });

        // 다음 버튼 상태 업데이트
        function updateNextButton() {
            // 필수 동의 항목들 확인
            const requiredCheckboxes = Array.from(detailConsentCheckboxes).filter(cb => 
                cb.name !== 'communicationInfo' // 선택 항목 제외
            );
            
            const allRequiredChecked = requiredCheckboxes.every(cb => cb.checked);
            
            if (allRequiredChecked) {
                nextBtn.classList.remove('btn-secondary');
                nextBtn.classList.add('btn-primary');
            } else {
                nextBtn.classList.remove('btn-primary');
                nextBtn.classList.add('btn-secondary');
            }
        }

        // 다음 버튼 클릭 처리
        function handleNext() {
            // 필수 동의 항목들 확인
            const requiredCheckboxes = Array.from(detailConsentCheckboxes).filter(cb => 
                cb.name !== 'communicationInfo' // 선택 항목 제외
            );
            
            const allRequiredChecked = requiredCheckboxes.every(cb => cb.checked);
            
            if (!allRequiredChecked) {
                alert('필수 동의 항목을 모두 체크해주세요.');
                return;
            }
            
            // 동의 정보 저장
            saveConsentData();
            
            // 다음 단계로 진행
            alert('동의가 완료되었습니다. 다음 단계로 진행합니다.');
            // 실제로는 다음 페이지로 리다이렉트
            // window.location.href = '/next-step';
        }

        // 동의 정보 저장
        function saveConsentData() {
            const consentData = {};
            
            // 전체동의 상태
            consentData.allConsent = allConsentCheckbox.checked;
            
            // 상세 동의 항목들
            detailConsentCheckboxes.forEach(checkbox => {
                consentData[checkbox.name] = checkbox.checked;
            });
            
            // 개인신용정보 수집이용 동의서 (선택)
            consentData.personalCreditConsent = personalCreditConsentCheckbox.checked;
            
            // 세션스토리지에 저장
            sessionStorage.setItem('consentData', JSON.stringify(consentData));
        }

        // 이전 버튼 클릭
        function goBack() {
            window.location.href = '/notice';
        }

        // 동의서 항목 클릭 시 상세 내용 보기 (현재는 알림으로 대체)
        document.querySelectorAll('.consent-item').forEach(item => {
            item.addEventListener('click', function(e) {
                // 체크박스나 화살표 클릭이 아닌 경우에만 상세 내용 보기
                if (e.target.classList.contains('arrow')) {
                    e.preventDefault();
                    const consentText = this.querySelector('.consent-text').textContent;
                    alert(`${consentText}\n\n상세 내용을 확인하실 수 있습니다.`);
                }
            });
        });

        // 초기 상태 설정
        updateNextButton();
    </script>
</body>
</html>
